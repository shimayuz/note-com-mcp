# note MCP Server - Cursor Setup Rules

このファイルは、Cursorが自動的にnote MCP Serverのセットアップを実行するためのルールを定義しています。

---

## 🎯 目的

非エンジニアのユーザーが「セットアップして」と指示するだけで、Cursorが以下のすべてのステップを自動実行できるようにする。

---

## 📋 セットアップ手順（Cursor実行用）

### Phase 1: 環境確認

1. Node.js のバージョン確認
   ```bash
   node --version
   ```
   - v18.0.0 以上であること
   - インストールされていない場合は、ユーザーに案内

2. npm のバージョン確認
   ```bash
   npm --version
   ```
   - v9.0.0 以上であること

3. Git のバージョン確認
   ```bash
   git --version
   ```

### Phase 2: 依存関係インストール

1. npm パッケージインストール
   ```bash
   npm install
   ```
   - 成功: "added XXX packages" メッセージ
   - 失敗: エラーメッセージを確認し対処

2. Playwright ブラウザインストール
   ```bash
   npx playwright install
   ```
   - Chromium, Firefox, WebKit がダウンロードされる

### Phase 3: ビルド

1. TypeScript ビルド
   ```bash
   npm run build
   ```
   - エラーがないこと確認

2. ビルド成果物確認
   ```bash
   ls build/
   ```
   - `note-mcp-server.js` が存在すること

### Phase 4: 環境変数設定

1. .env ファイル作成（存在しない場合）
   ```bash
   # Mac/Linux
   touch .env
   
   # Windows PowerShell
   New-Item -Path .env -ItemType File -Force
   ```

2. .env.sample から .env を作成（推奨）
   ```bash
   cp .env.sample .env
   ```

### Phase 5: 動作確認

1. サーバー起動テスト
   ```bash
   npm run start
   ```
   - "MCP Server started" が表示されること
   - Ctrl+C で終了

### Phase 6: MCP クライアント設定

#### Cursor の場合

1. 現在のプロジェクトパスを取得
   ```bash
   pwd
   ```

2. MCP 設定ファイルのパス
   - Mac: `~/.cursor/mcp.json`
   - Windows: `%USERPROFILE%\.cursor\mcp.json`

3. 設定内容生成（Mac用）
   ```json
   {
     "mcpServers": {
       "note-api": {
         "command": "node",
         "args": ["${PROJECT_PATH}/build/note-mcp-server.js"],
         "env": {
           "NOTE_EMAIL": "${NOTE_EMAIL}",
           "NOTE_PASSWORD": "${NOTE_PASSWORD}",
           "NOTE_USER_ID": "${NOTE_USER_ID}"
         }
       }
     }
   }
   ```

4. 設定内容生成（Windows用）
   ```json
   {
     "mcpServers": {
       "note-api": {
         "command": "node",
         "args": ["${PROJECT_PATH}\\build\\note-mcp-server.js"],
         "env": {
           "NOTE_EMAIL": "${NOTE_EMAIL}",
           "NOTE_PASSWORD": "${NOTE_PASSWORD}",
           "NOTE_USER_ID": "${NOTE_USER_ID}"
         }
       }
     }
   }
   ```

---

## 🔧 コマンドリファレンス

### 基本コマンド

| 目的 | コマンド |
|------|---------|
| インストール | `npm install` |
| ビルド | `npm run build` |
| 起動（ローカル） | `npm run start` |
| 起動（HTTP） | `npm run start:http` |
| 開発モード | `npm run dev:watch` |

### Playwright コマンド

| 目的 | コマンド |
|------|---------|
| ブラウザインストール | `npx playwright install` |
| 依存ライブラリインストール | `npx playwright install-deps` |
| セッションキャプチャ | `npm run capture:session` |

---

## 🖥️ OS別コマンド

### ディレクトリ作成

```bash
# Mac/Linux
mkdir -p ~/.cursor

# Windows PowerShell
New-Item -Path "$env:USERPROFILE\.cursor" -ItemType Directory -Force
```

### ファイル作成

```bash
# Mac/Linux
touch filename

# Windows PowerShell
New-Item -Path filename -ItemType File -Force
```

### 現在のパス確認

```bash
# Mac/Linux/Windows
pwd
```

### ホームディレクトリ移動

```bash
# Mac/Linux
cd ~

# Windows PowerShell
cd $env:USERPROFILE
```

---

## ✅ セットアップ完了チェックリスト

Cursorは以下の項目を順番に確認・実行する：

1. [ ] `node --version` → v18.0.0 以上
2. [ ] `npm --version` → v9.0.0 以上
3. [ ] `git --version` → インストール済み
4. [ ] `npm install` → 成功
5. [ ] `npx playwright install` → 成功
6. [ ] `npm run build` → 成功
7. [ ] `ls build/note-mcp-server.js` → ファイル存在
8. [ ] `.env` ファイル設定済み（オプション）
9. [ ] `npm run start` → 起動成功
10. [ ] MCP設定ファイル作成済み

---

## 🚨 エラーハンドリング

### npm install 失敗時

```bash
# キャッシュクリア
npm cache clean --force

# 再インストール
rm -rf node_modules package-lock.json
npm install
```

### playwright install 失敗時

```bash
# 依存ライブラリインストール（Linux/WSL）
npx playwright install-deps

# 再インストール
npx playwright install
```

### build 失敗時

```bash
# node_modules 再インストール
rm -rf node_modules
npm install

# 再ビルド
npm run build
```

### 認証エラー時

```bash
# セッション再取得（ブラウザログイン）
rm .env
npm run start
```

---

## 📁 重要なファイルパス

| ファイル | 説明 |
|---------|------|
| `package.json` | プロジェクト設定 |
| `.env` | 環境変数（認証情報） |
| `.env.sample` | 環境変数サンプル |
| `build/note-mcp-server.js` | ビルド済みサーバー |
| `src/note-mcp-server.ts` | ソースコード |
| `docs/SETUP_GUIDE.md` | 詳細セットアップガイド |

---

## 🔐 認証設定

### 方法A: ブラウザログイン（推奨）

1. `.env` ファイルなしで起動
2. ブラウザが自動で開く
3. 手動でログイン
4. セッション情報が自動保存

### 方法B: .env ファイル

```env
NOTE_EMAIL=your-email@example.com
NOTE_PASSWORD=your-password
NOTE_USER_ID=your-user-id
```

---

## 📝 ユーザーへの説明テンプレート

セットアップ完了後、以下のように説明する：

```
セットアップが完了しました！

以下のコマンドでサーバーを起動できます：
npm run start

Cursorでnote.comの記事を検索・投稿できるようになりました。
例：「noteで『プログラミング』の記事を検索して」
```
